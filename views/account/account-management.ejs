<div class="account-form-container account-management-view">
    <h1 class="page-heading">
        <%= locals.title %>
    </h1>

    <!-- Message Processing Block: Safely extract all flash messages into a single array -->
    <%
    let allMessages = [];
    if (typeof messages === 'object' && messages !== null) {
    // Iterate over keys (e.g., 'success', 'error') and flatten the arrays within them.
    Object.keys(messages).forEach(key => {
    if (Array.isArray(messages[key])) {
    allMessages = allMessages.concat(messages[key]);
    }
    });
    }
    %>

    <!-- Display Flash Messages (Success and regular messages use 'notice' class) -->
    <% if (allMessages.length > 0) { %>
        <ul class="flash-message notice success-notice" role="alert">
        <% allMessages.forEach(message => { %>
            <li><%= message %></li>
        <% }); %>
        </ul>
    <% } %>

    <!-- Display Validation Errors -->
    <% if (errors && errors.length > 0) { %>
        <ul class="notice error-notice" role="alert">
        <% errors.forEach(error => { %>
            <li><%= error.msg %></li>
        <% }); %>
        </ul>
    <% } %>

    <!-- Main Content Card -->
    <div class="form-card account-summary-card">
        
        <%
        // Pull account data from locals for cleaner EJS usage
        const account = locals.accountData; 
        %>
        
        <!-- Universal Greeting -->
        <h2 class="welcome-heading">
            Welcome <%= account.account_firstname %>
        </h2>

        <!-- Update Account Information Link (Styled as a Button) -->
        <p class="update-link-wrapper">
            <a href="/account/update/<%= account.account_id %>" 
                class="button primary-button"
                title="Update account information">
                Update Account Information
            </a>
        </p>

        <!-- Inventory Management Section (Employee or Admin Only) -->
        <% if (account.account_type === 'Employee' || account.account_type === 'Admin') { %>
            <hr class="section-divider">

            <!-- Heading -->
            <h3 class="management-heading">
                Inventory Management
                <% if (account.account_type === 'Admin') { %> (Admin) <% } %>
            </h3>
            
            <!-- Link to Inventory Management View -->
            <p class="management-link-wrapper">
                <a href="/inv/" 
                    class="management-link"
                    title="Access the Inventory Management area">
                    Manage Inventory
                </a>
            </p>
        <% } %>
    </div>

</div>
